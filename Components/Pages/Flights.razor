@page "/flights"
@using Assignment2

<style>
    .maincontent
    {
        margin:0;
        display: flex;
        flex-wrap:wrap;
    }
    .maincontent > div
    {
        flex-grow:1;
    }
    .maincontent > div:nth-child(3)
    {
/*         background-color:lightblue; */
        width:100%;

    }
    .maincontent > div:nth-child(2)
    {
        text-align:right;
        position:relative;
        margin-right:0;
/*         background-color:lightcoral; */
    }
    .maincontent > div:nth-child(1)
    {
/*         background-color:lightyellow; */
    }
    .maincontent div:nth-child(2) > input
    {
        margin-right:0;
        margin:auto;
    }
   
    h3
    {
        text-align:center;
    }

    .reserve
    {
        display: flex;
        flex-direction: row;
        justify-content:flex-end;
        align-items: flex-end;
    }
    .reserve > form > button
    {
        display:block;
        margin:auto;
        margin-left:53%;
        margin-top:1em;
        background-color:royalblue;
        color:white;
        border-radius:5px;
    }
    .reserve > form > input
    {
        border-radius:5px;
        width:300px;
    }
    
    .flightfinder
    {
        text-align:right;
        margin:50px;
    }
    .flightfinder > form > div > select
    {
        width:85%;
        border-radius:5px;
    }

    .flightfinder > form > button {
        display: block;
        margin: auto;
        margin-top: 1em;
        background-color: royalblue;
        color: white;
        border-radius:5px;
    }


</style>
<div class="maincontent">
        <div class="flights">
            <h3>Flights</h3>
            @foreach (Flight flight in foundFlightList)
            {
                <p>@Flight.DisplayFlight(flight)</p>
                @* <div>
                <button type="button" @onclick="UpdateFields"><p @bind="flightButton">@Flight.DisplayFlight(flight)</p></button>
                </div> *@
            }
        </div>

        <div class="reserve">    
            <form>
                <h3>Reserve</h3>
                <label for="flight">Flight:</label>
                <input type="text" name="flight" @bind="flightCode" @oninput="PassUpdateFields"/><br />

                <label for="airline">Airline:</label>
                <input type="text" name="airline" @bind="@airlineName" readonly/><br />

                <label for="day">Day:</label>
            <input type="text" name="day" @bind="@weekDate" readonly /><br />

                <label for="time">Time:</label>
            <input type="text" name="time" @bind="@time" readonly /><br />

                <label for="cost">Cost:</label>
            <input type="text" name="cost" @bind="@cost" readonly /><br />

                <label for="name">Name:</label>
                <input type="text" name="name" @bind="@customerName"/><br />

                <label for="citizenship">Citizenship:</label>
                <input type="text" name="citizenship" @bind="@citizenship"/><br />

                <button type="submit" @onclick="PassReservation">Reserve</button>
            </form>            
        </div>
    <div class="flightfinder">
        <h3>Flight Finder</h3><br />
        <form>
            <div>
                <label for="from">From:</label>
                <select name="from" @bind="originAirportCode">
                    <option value="YYC">YYC</option>
                    <option value="YEG">YEG</option>
                    <option value="YUL">YUL</option>
                    <option value="YOW">YOW</option>
                    <option value="YYZ">YYZ</option>
                    <option value="YVR">YVR</option>
                    <option value="YWG">YWG</option>
                    <option value="ATL">ATL</option>
                    <option value="PEK">PEK</option>
                    <option value="DXB">DXB</option>
                    <option value="HKG">HKG</option>
                    <option value="LHR">LHR</option>
                    <option value="HND">HND</option>
                    <option value="ORD">ORD</option>
                    <option value="PVG">PVG</option>
                    <option value="CDG">CDG</option>
                    <option value="AMS">AMS</option>
                    <option value="DEL">DEL</option>
                    <option value="FRA">FRA</option>
                    <option value="DFW">DFW</option>
                </select><br />
            </div>

            <div>
                <label for="to">To:</label>
                <select name="to" @bind="destAirportCode">
                    <option value="YYC">YYC</option>
                    <option value="YEG">YEG</option>
                    <option value="YUL">YUL</option>
                    <option value="YOW">YOW</option>
                    <option value="YYZ">YYZ</option>
                    <option value="YVR">YVR</option>
                    <option value="YWG">YWG</option>
                    <option value="ATL">ATL</option>
                    <option value="PEK">PEK</option>
                    <option value="DXB">DXB</option>
                    <option value="HKG">HKG</option>
                    <option value="LHR">LHR</option>
                    <option value="HND">HND</option>
                    <option value="ORD">ORD</option>
                    <option value="PVG">PVG</option>
                    <option value="CDG">CDG</option>
                    <option value="AMS">AMS</option>
                    <option value="DEL">DEL</option>
                    <option value="FRA">FRA</option>
                    <option value="DFW">DFW</option>
                </select><br />
            </div>

            <div>
                <label for="day">Day:</label>
                <select name="day" @bind="day">
                    <option value="Any">Any</option>
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                    <option value="Saturday">Saturday</option>
                    <option value="Sunday">Sunday</option>
                </select><br />
            </div>

            <button type="button" @onclick="PassFlightFinder">Find Flights</button>
        </form>
    </div>
</div>



@code {
    private string flightCode { get; set; }
    private string airlineName { get; set; } = "";
    private string weekDate { get; set; } = "";
    private string time { get; set; } = "";
    private double cost { get; set; } = 0;
    private string customerName { get; set; }
    private string citizenship { get; set; }

    private string originAirportCode { get; set; } = "YYC";
    private string destAirportCode { get; set; } = "YYC";
    private string day { get; set; } = "Any";
    private List<Flight> foundFlightList { get; set; } = new List<Flight>();

    private Flight flightButton { get; set; }

    private void PassFlightFinder()
    {
        Airport originAirport = Airport.LoadAirportFromCode(originAirportCode);
        Airport destAirport = Airport.LoadAirportFromCode(destAirportCode);
        string weekDay = day;
        foundFlightList = Flight.FindFlights(originAirport, destAirport, weekDay);
    }

    private void PassReservation()
    {
        Flight foundFlight = Flight.GetFlightFromCode(flightCode);
        string name = customerName;
        string cit = citizenship;
        ReservationManager.MakeReservation(foundFlight, name, cit);
    }

    private void PassUpdateFields(ChangeEventArgs e)
    {
        flightCode = e.Value.ToString();
        UpdateFields();
    }

    // private void UpdateFields()
    // {       
    //     Flight foundFlightPop = Flight.GetFlightFromCode(flightCode);
    //     if (foundFlightPop != null)
    //     {
    //         airlineName = foundFlightPop.AirlineName;
    //         weekDate = foundFlightPop.WeekDate;
    //         time = foundFlightPop.Time;
    //         cost = foundFlightPop.Cost;
    //     }       
    // }
    private void UpdateFields()
    {
        airlineName = flightButton.AirlineName;
        weekDate = flightButton.WeekDate;
        time = flightButton.Time;
        cost = flightButton.Cost;
    }

}